<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="fragments/layout :: layoutBase('Registros', 'Editar', ~{::contenido}, ~{::scripts})">

<th:block th:fragment="contenido">

    <div class="card shadow-sm p-4">
        <h5 class="mb-4">
            <i class="fa-solid fa-pen me-1"></i>
            Editar registro RUC10
        </h5>

        <form method="post" th:object="${ruc10DTO}" th:action="@{/registros/guardar}" novalidate>
            <div class="row">
                <!-- Código (oculto y deshabilitado) -->
                <input type="hidden" th:field="*{registrationId}"/>
                <input type="hidden" th:field="*{districtId}" />

                <div class="col-md-6 mb-3">
                    <label for="idRegistroVisible" class="form-label">
                        Código
                    </label>
                    <input type="number" th:value="*{registrationId}" class="form-control" id="idRegistroVisible" disabled />
                </div>

                <div class="col-md-6 mb-3">
                    <label for="idEstado" class="form-label">
                        Estado
                        <span class="text-danger">*</span>
                    </label>
                    <select th:field="*{statusId}" class="form-select" required>
                        <option th:each="s : ${estados}"
                                th:value="${s.id}"
                                th:text="${s.description}">
                        </option>
                    </select>
                </div>

                <!-- ==================================================== -->
                <!-- PASO 1: DATOS DE LOS TRABAJADORES                    -->
                <!-- ==================================================== -->
                <h6 class="mb-3">
                    <i class="fas fa-users-cog me-1"></i>
                    Datos de los trabajadores
                </h6>

                <!-- Consultor -->
                <div class="col-md-6 mb-3">
                    <label for="consultantUserId" class="form-label">
                        Consultor
                        <span class="text-danger">*</span>
                    </label>
                    <select th:field="*{consultantUserId}" class="form-select" required>
                        <option th:each="c : ${consultores}"
                                th:value="${c.id}"
                                th:text="${c.firstName + ' ' + c.lastName}">
                        </option>
                    </select>
                </div>

                <!-- Supervisor -->
                <div class="col-md-6 mb-3">
                    <label for="idUsuarioSupervisor" class="form-label">
                        Supervisor
                        <span class="text-danger">*</span>
                    </label>
                    <select th:field="*{supervisorUserId}" class="form-select" required>
                        <option th:each="s : ${supervisores}"
                                th:value="${s.id}"
                                th:text="${s.firstName + ' ' + s.lastName}">
                        </option>
                    </select>
                </div>

                <!-- ==================================================== -->
                <!-- PASO 2: DATOS DEL CLIENTE                            -->
                <!-- ==================================================== -->
                <h6 class="mb-3">
                    <i class="fa-solid fa-building-user me-1"></i>
                    Datos del cliente
                </h6>

                <!-- DNI -->
                <div class="col-md-4 mb-3">
                    <label for="clientDni" class="form-label">
                        DNI
                        <span class="text-danger">*</span>
                    </label>
                    <input type="number" th:field="*{clientDni}" class="form-control"
                           th:classappend="${#fields.hasErrors('clientDni')} ? 'is-invalid'" placeholder="Ingrese un DNI" required />
                    <div class="invalid-feedback" th:errors="*{clientDni}"></div>
                </div>

                <!-- Nombre(s) -->
                <div class="col-md-4 mb-3">
                    <label for="clientFirstName" class="form-label">
                        Nombre(s)
                        <span class="text-danger">*</span>
                    </label>
                    <input type="text" th:field="*{clientFirstName}" class="form-control"
                           th:classappend="${#fields.hasErrors('clientFirstName')} ? 'is-invalid'" placeholder="Ingrese un(os) nombre(s)" required />
                    <div class="invalid-feedback" th:errors="*{clientFirstName}"></div>
                </div>

                <!-- Apellido(s) -->
                <div class="col-md-4 mb-3">
                    <label for="clientLastName" class="form-label">
                        Apellido(s)
                        <span class="text-danger">*</span>
                    </label>
                    <input type="text" th:field="*{clientLastName}" class="form-control"
                           th:classappend="${#fields.hasErrors('clientLastName')} ? 'is-invalid'" placeholder="Ingrese un(os) apellido(s)" required />
                    <div class="invalid-feedback" th:errors="*{clientLastName}"></div>
                </div>

                <!-- Teléfono -->
                <div class="col-md-6 mb-3">
                    <label for="clientPhone" class="form-label">
                        Teléfono
                        <span class="text-danger">*</span>
                    </label>
                    <input type="number" th:field="*{clientPhone}" class="form-control"
                           th:classappend="${#fields.hasErrors('clientPhone')} ? 'is-invalid'" placeholder="Ingrese un teléfono" required />
                    <div class="invalid-feedback" th:errors="*{clientPhone}"></div>
                </div>

                <!-- RUC -->
                <div class="col-md-6 mb-3">
                    <label for="clientRuc" class="form-label">
                        RUC
                        <span class="text-danger">*</span>
                    </label>
                    <input type="number" th:field="*{clientRuc}" class="form-control"
                           th:classappend="${#fields.hasErrors('clientRuc')} ? 'is-invalid'" placeholder="Ingrese un RUC" required />
                    <div class="invalid-feedback" th:errors="*{clientRuc}"></div>
                </div>

                <!-- ==================================================== -->
                <!-- PASO 3: REPRESENTANTE LEGAL                          -->
                <!-- ==================================================== -->
                <h6 class="mb-3">
                    <i class="fas fa-user-tie me-1"></i>
                    Representante legal
                </h6>

                <!-- Nombre contacto -->
                <div class="col-md-6 mb-3">
                    <label for="mainContactName" class="form-label">
                        Nombre contacto
                        <span class="text-danger">*</span>
                    </label>
                    <input type="text" th:field="*{mainContactName}" class="form-control"
                           th:classappend="${#fields.hasErrors('mainContactName')} ? 'is-invalid'" placeholder="Ingrese un nombre" required />
                    <div class="invalid-feedback" th:errors="*{mainContactName}"></div>
                </div>

                <!-- DNI -->
                <div class="col-md-6 mb-3">
                    <label for="mainContactDni" class="form-label">
                        DNI
                        <span class="text-danger">*</span>
                    </label>
                    <input type="number" th:field="*{mainContactDni}" class="form-control"
                           th:classappend="${#fields.hasErrors('mainContactDni')} ? 'is-invalid'" placeholder="Ingrese un DNI" required />
                    <div class="invalid-feedback" th:errors="*{mainContactDni}"></div>
                </div>

                <!-- Correo electrónico -->
                <div class="col-md-6 mb-3">
                    <label for="mainContactEmail" class="form-label">
                        Correo electrónico
                        <span class="text-danger">*</span>
                    </label>
                    <input type="email" th:field="*{mainContactEmail}" class="form-control"
                           th:classappend="${#fields.hasErrors('mainContactEmail')} ? 'is-invalid'" placeholder="correo@ejemplo.com" required />
                    <div class="invalid-feedback" th:errors="*{mainContactEmail}"></div>
                </div>

                <!-- Teléfono -->
                <div class="col-md-6 mb-3">
                    <label for="mainContactPhone" class="form-label">
                        Teléfono
                        <span class="text-danger">*</span>
                    </label>
                    <input type="number" th:field="*{mainContactPhone}" class="form-control"
                           th:classappend="${#fields.hasErrors('mainContactPhone')} ? 'is-invalid'" placeholder="Ingrese un teléfono" required />
                    <div class="invalid-feedback" th:errors="*{mainContactPhone}"></div>
                </div>

                <!-- ==================================================== -->
                <!-- PASO 4: CONTACTO AUTORIZADO                          -->
                <!-- ==================================================== -->
                <h6 class="mb-3">
                    <i class="fas fa-user-check me-1"></i>
                    Contacto autorizado
                </h6>

                <!-- Nombre completo -->
                <div class="col-md-6 mb-3">
                    <label for="secondaryContactName" class="form-label">
                        Nombre completo
                        <span class="text-danger">*</span>
                    </label>
                    <input type="text" th:field="*{secondaryContactName}" class="form-control"
                           th:classappend="${#fields.hasErrors('secondaryContactName')} ? 'is-invalid'" placeholder="Ingrese un nombre" required />
                    <div class="invalid-feedback" th:errors="*{secondaryContactName}"></div>
                </div>

                <!-- DNI -->
                <div class="col-md-6 mb-3">
                    <label for="secondaryContactDni" class="form-label">
                        DNI
                        <span class="text-danger">*</span>
                    </label>
                    <input type="number" th:field="*{secondaryContactDni}" class="form-control"
                           th:classappend="${#fields.hasErrors('secondaryContactDni')} ? 'is-invalid'" placeholder="Ingrese un DNI" required />
                    <div class="invalid-feedback" th:errors="*{secondaryContactDni}"></div>
                </div>

                <!-- Correo electrónico -->
                <div class="col-md-6 mb-3">
                    <label for="secondaryContactEmail" class="form-label">
                        Correo electrónico
                        <span class="text-danger">*</span>
                    </label>
                    <input type="email" th:field="*{secondaryContactEmail}" class="form-control"
                           th:classappend="${#fields.hasErrors('secondaryContactEmail')} ? 'is-invalid'" placeholder="correo@ejemplo.com" required />
                    <div class="invalid-feedback" th:errors="*{secondaryContactEmail}"></div>
                </div>

                <!-- Teléfono -->
                <div class="col-md-6 mb-3">
                    <label for="secondaryContactPhone" class="form-label">
                        Teléfono
                        <span class="text-danger">*</span>
                    </label>
                    <input type="number" th:field="*{secondaryContactPhone}" class="form-control"
                           th:classappend="${#fields.hasErrors('secondaryContactPhone')} ? 'is-invalid'" placeholder="Ingrese un teléfono" required />
                    <div class="invalid-feedback" th:errors="*{secondaryContactPhone}"></div>
                </div>

                <!-- ==================================================== -->
                <!-- PASO 5: SERVICIO CONTRATADO                          -->
                <!-- ==================================================== -->
                <h6 class="mb-3">
                    <i class="fas fa-file-contract me-1"></i>
                    Servicio contratado
                </h6>

                <!-- Plan -->
                <div class="col-md-6 mb-3">
                    <label for="planId" class="form-label">
                        Plan
                        <span class="text-danger">*</span>
                    </label>
                    <select th:field="*{planId}" class="form-select" required>
                        <option th:each="p : ${planes}"
                                th:value="${p.id}"
                                th:text="${p.description}">
                        </option>
                    </select>
                </div>

                <!-- Promoción -->
                <div class="col-md-6 mb-3">
                    <label for="promotionId" class="form-label">
                        Promoción
                    </label>
                    <select th:field="*{promotionId}" class="form-select">
                        <option value="-1">Ninguna</option>
                        <option th:each="p : ${promociones}"
                                th:value="${p.id}"
                                th:text="${p.description}">
                        </option>
                    </select>
                </div>

                <!-- ==================================================== -->
                <!-- PASO 5.1: CÓDIGOS DE INTEGRACIÓN INTERNA             -->
                <!-- ==================================================== -->
                <h6 class="mb-3">
                    <i class="fa-solid fa-database me-1"></i>
                    Códigos de integración interna
                </h6>

                <!-- Cod. carrito -->
                <div class="col-md-4 mb-3">
                    <label for="cartId" class="form-label">Cod. carrito</label>
                    <input type="text" th:field="*{cartId}" class="form-control" placeholder="Ej. CSE00130678226"/>
                </div>

                <!-- Cod. instalación -->
                <div class="col-md-4 mb-3">
                    <label for="installationId" class="form-label">Cod. instalación</label>
                    <input type="text" th:field="*{installationId}" class="form-control" placeholder="Ej. 763952718"/>
                </div>

                <!-- Cod. solicitud -->
                <div class="col-md-4 mb-3">
                    <label for="requestId" class="form-label">Cod. solicitud</label>
                    <input type="text" th:field="*{requestId}" class="form-control" placeholder="Ej. 1QWERTYUI"/>
                </div>


                <!-- ==================================================== -->
                <!-- PASO 6: CRONOGRAMA                                   -->
                <!-- ==================================================== -->
                <h6 class="mb-3">
                    <i class="fas fa-calendar-alt me-1"></i>
                    Cronograma
                </h6>

                <!-- Lugar instalacion -->
                <div class="col-md-6 mb-3">
                    <label for="installationPlace" class="form-label">
                        Lugar instalacion
                        <span class="text-danger">*</span>
                    </label>
                    <input type="text" th:field="*{installationPlace}" class="form-control"
                           th:classappend="${#fields.hasErrors('installationPlace')} ? 'is-invalid'" placeholder="Ingrese un lugar" required />
                    <div class="invalid-feedback" th:errors="*{installationPlace}"></div>
                </div>

                <!-- Fecha instalación -->
                <div class="col-md-3 mb-3">
                    <label for="installationDate" class="form-label">
                        Fecha instalación
                        <span class="text-danger">*</span>
                    </label>
                    <input type="date" class="form-control" th:field="*{installationDate}" required />
                </div>

                <!-- Rango horario -->
                <div class="col-md-3 mb-3">
                    <label for="installationRange" class="form-label">
                        Rango horario
                        <span class="text-danger">*</span>
                    </label>
                    <select class="form-select" th:field="*{installationRange}" required>
                        <option value="manana">09:00 a 13:00 hr</option>
                        <option value="tarde">13:00 a 18:00 hr</option>
                    </select>
                </div>

                <!-- Observaciones -->
                <div class="col-md-12 mb-3">
                    <label for="observation" class="form-label">
                        Observaciones
                    </label>
                    <input type="text" class="form-control" th:field="*{observation}" placeholder="Ingrese observaciones (opcional)" />
                </div>
            </div>

            <!-- Botones -->
            <div class="d-flex justify-content-end">
                <a th:href="@{/registros}" class="btn btn-secondary me-1 mb-0">
                    <i class="fas fa-times me-1"></i>
                    Cancelar
                </a>

                <button type="submit" class="btn btn-primary mb-0">
                    <i class="fas fa-save me-1"></i>
                    Actualizar
                </button>
            </div>
        </form>
    </div>
</th:block>

<th:block th:fragment="scripts">
    <script>
    document.querySelectorAll('input').forEach(input => {
        input.addEventListener('input', () => {
            input.classList.remove('is-invalid');
        });
    });

    document.querySelectorAll('select').forEach(select => {
        select.addEventListener('change', () => {
            select.classList.remove('is-invalid');
        });
    });
    </script>
</th:block>
</html>